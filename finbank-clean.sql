DECLARE
V_COUNT INTEGER;
BEGIN
SELECT COUNT(TABLE_NAME) INTO V_COUNT from USER_TABLES where TABLE_NAME = '__EFMigrationsHistory';
IF V_COUNT = 0 THEN
Begin
BEGIN 
EXECUTE IMMEDIATE 'CREATE TABLE 
"__EFMigrationsHistory" (
    "MigrationId" NVARCHAR2(150) NOT NULL,
    "ProductVersion" NVARCHAR2(32) NOT NULL,
    CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY ("MigrationId")
)';
END;

End;

END IF;
EXCEPTION
WHEN OTHERS THEN
    IF(SQLCODE != -942)THEN
        RAISE;
    END IF;
END;
/

DECLARE
    USEREXIST INTEGER;
    USER_NOT_EXIST EXCEPTION;
    PRAGMA EXCEPTION_INIT( USER_NOT_EXIST, -01435 );
BEGIN
SELECT COUNT(*) INTO USEREXIST FROM ALL_USERS WHERE USERNAME='rm93032';
IF (USEREXIST = 0) THEN
    RAISE USER_NOT_EXIST;
END IF;
END;
/

BEGIN 
EXECUTE IMMEDIATE 'CREATE TABLE 
"rm93032"."Clientes" (
    "Id" NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL,
    "NomeCompleto" NVARCHAR2(2000) NOT NULL,
    "Cpf" NVARCHAR2(2000) NOT NULL,
    "Email" NVARCHAR2(2000) NOT NULL,
    CONSTRAINT "PK_Clientes" PRIMARY KEY ("Id")
)';
END;
/

BEGIN 
EXECUTE IMMEDIATE 'CREATE TABLE 
"rm93032"."ContasBancarias" (
    "Id" NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL,
    "NumeroConta" NVARCHAR2(2000) NOT NULL,
    "Agencia" NVARCHAR2(2000) NOT NULL,
    "TipoConta" NVARCHAR2(2000) NOT NULL,
    "ClienteId" NUMBER(10) NOT NULL,
    CONSTRAINT "PK_ContasBancarias" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_ContasBancarias_Clientes_ClienteId" FOREIGN KEY ("ClienteId") REFERENCES "rm93032"."Clientes" ("Id") ON DELETE CASCADE
)';
END;
/

BEGIN 
EXECUTE IMMEDIATE 'CREATE TABLE 
"rm93032"."Transacoes" (
    "Id" NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL,
    "Tipo" NVARCHAR2(2000) NOT NULL,
    "Valor" DECIMAL(18, 2) NOT NULL,
    "Data" TIMESTAMP(7) NOT NULL,
    "ContaBancariaId" NUMBER(10) NOT NULL,
    CONSTRAINT "PK_Transacoes" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Transacoes_ContasBancarias_ContaBancariaId" FOREIGN KEY ("ContaBancariaId") REFERENCES "rm93032"."ContasBancarias" ("Id") ON DELETE CASCADE
)';
END;
/

CREATE INDEX "rm93032"."IX_ContasBancarias_ClienteId" ON "rm93032"."ContasBancarias" ("ClienteId")
/

CREATE INDEX "rm93032"."IX_Transacoes_ContaBancariaId" ON "rm93032"."Transacoes" ("ContaBancariaId")
/

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES (N'20251006232903_InitialCreate', N'9.0.9')
/

